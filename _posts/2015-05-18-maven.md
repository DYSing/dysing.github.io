---
layout: post
title:  "Maven 控制台输出内容乱码"
date:   2015-05-18 15:22:15
keywords: Maven,乱码
description: Maven test 时控制台输出乱码解决方法及分析
categories: 
comment: true
duoshuokey: 20150518152215
---
# Maven 执行Test时控制台输出中文乱码原因分析及解决方法

## 起因

<p>今天下午使用Maven构建项目时，运行测试失败，查看出错原因时发现控制台输出如下图</p>
![Maven控制台乱码1](/resources/20150518/maven1.jpg)

## 经过

<p>Google一下以后发现[maven-surefire-plugin的乱码问题](http://monsoongale.iteye.com/blog/1028926)
目测跟我遇到的原因相同，这里直接把主要内容复制过来</p>

>究其原因,是因为MAVEN的maven-surefire-plugin在新建JVM进程后,由于没有指定encoding,采用了OS的默认编码,导致读取UTF-8文件(测试类的sql脚本文件)时出现乱码,最终影响了TestNG的正确执行.

<p>具体原因如下：</p>

>maven-surefire-plugin是运行mvn test时执行测试的插件,其有一个配置参数forkMode,默认为once,即表示每次运行test时,新建一个JVM进程运行所有test.这可能会导致乱码问题.首先将forkMode设置为never,即不新建.再运行mvn test,全部OK了.果然是这个问题!! 
于是再找官方参数说明,发现了argLine参数,这个参数与forkMode一起使用,可以设置新建JVM时的JVM启动参数,于是设置<argLine>-Dfile.encoding=UTF-8</argLine>,明确指定一下JVM的file.encoding,并将forkMode从never改回once,还是每次新建一个JVM进程.再次运行mvn test,一起OK了,问题解决.

## 结果

<p>修改后的pom.xml</p>

{% highlight html%}
	<build>
		<plugins>
			<!-- 解决maven test命令时console出现中文乱码乱码 -->
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.7.2</version>
				<configuration>
					<forkMode>once</forkMode>
 					<argLine>-Dfile.encoding=UTF-8</argLine> 
				</configuration>
			</plugin>
		</plugins>
	</build>
{% endhighlight %}

<p>重点是</p>
` <argLine>-Dfile.encoding=UTF-8</argLine>`